
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Scopes · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="EventBus.html" />
    
    
    <link rel="prev" href="OSGi.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../part1/0. Subsection.html">
            
                <a href="../part1/0. Subsection.html">
            
                    
                    第一部分: TornadoFX 基本介紹
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../part1/1. Why TornadoFX.html">
            
                <a href="../part1/1. Why TornadoFX.html">
            
                    
                    1. 為什麼選擇 TornadoFX?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../part1/2. Setting Up.html">
            
                <a href="../part1/2. Setting Up.html">
            
                    
                    2. 配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../part1/3. Components.html">
            
                <a href="../part1/3. Components.html">
            
                    
                    3. 組件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../part1/4. Basic Controls.html">
            
                <a href="../part1/4. Basic Controls.html">
            
                    
                    4. Basic Controls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../part1/5. Data Controls.html">
            
                <a href="../part1/5. Data Controls.html">
            
                    
                    5. Data Controls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../part1/6. CSS.html">
            
                <a href="../part1/6. CSS.html">
            
                    
                    6. Type Safe CSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../part1/7. Layouts and Menus.html">
            
                <a href="../part1/7. Layouts and Menus.html">
            
                    
                    7. Layouts and Menus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../part1/8. Charts.html">
            
                <a href="../part1/8. Charts.html">
            
                    
                    8. Charts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../part1/9. Shapes and Animation.html">
            
                <a href="../part1/9. Shapes and Animation.html">
            
                    
                    9. Shapes and Animation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../part1/10. FXML.html">
            
                <a href="../part1/10. FXML.html">
            
                    
                    10. FXML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="../part1/11. Editing Models and Validation.html">
            
                <a href="../part1/11. Editing Models and Validation.html">
            
                    
                    11. Editing Models and Validation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="../part1/12. TornadoFX IDEA Plugin.html">
            
                <a href="../part1/12. TornadoFX IDEA Plugin.html">
            
                    
                    12. TornadoFX IDEA Plugin
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="0. Subsection.html">
            
                <a href="0. Subsection.html">
            
                    
                    Part 2: TornadoFX Advanced Features
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="Property Delegates.html">
            
                <a href="Property Delegates.html">
            
                    
                    Property Delegates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="Advanced Data Controls.html">
            
                <a href="Advanced Data Controls.html">
            
                    
                    Advanced Data Controls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="OSGi.html">
            
                <a href="OSGi.html">
            
                    
                    OSGi
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.4" data-path="Scopes.html">
            
                <a href="Scopes.html">
            
                    
                    Scopes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="EventBus.html">
            
                <a href="EventBus.html">
            
                    
                    EventBus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="Workspaces.html">
            
                <a href="Workspaces.html">
            
                    
                    Workspaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="Layout Debugger.html">
            
                <a href="Layout Debugger.html">
            
                    
                    Layout Debugger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="Internationalization.html">
            
                <a href="Internationalization.html">
            
                    
                    Internationalization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="Config Settings and State.html">
            
                <a href="Config Settings and State.html">
            
                    
                    Config Settings and State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="JSON and REST.html">
            
                <a href="JSON and REST.html">
            
                    
                    JSON and REST
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.11" data-path="Dependency Injection.html">
            
                <a href="Dependency Injection.html">
            
                    
                    Dependency Injection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.12" data-path="Wizard.html">
            
                <a href="Wizard.html">
            
                    
                    Wizard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.13" data-path="Integration.html">
            
                <a href="Integration.html">
            
                    
                    Integrating with other tech
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../part3/0. Subsection.html">
            
                <a href="../part3/0. Subsection.html">
            
                    
                    Part 3: Cook Book
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../part3/Snippets.html">
            
                <a href="../part3/Snippets.html">
            
                    
                    Snippets
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Scopes</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="scopes">Scopes</h1>
<p>Scope is a simple construct that enables some interesting and helpful behavior in a TornadoFX application. A Scope can be viewed as the &quot;context&quot; with which the parent singleton <code>Component</code> and any possible children <code>Component</code>s that may exist in the same context. Within that context, it is easy to pass around the subset of instances from one <code>Component</code> to another.</p>
<p><img src="https://github.com/ahinchman1/TornadoFX-DnD-TilesFX/blob/master/Scopes.png" alt="alttext"></p>
<p>When you use <code>inject()</code> or <code>find()</code> to locate a <code>Controller</code> or a <code>View</code>, you will, by default, get back a singleton instance, meaning that wherever you locate that object in your code, you will get back the same instance. Scopes provide a way to make a <code>View</code> or <code>Controller</code> unique to a smaller subset of instances in your application.</p>
<p>Each <code>Component</code>, like <code>View</code>, <code>Fragment</code> and <code>Controller</code>, inherit whatever scope they were looked up in, so you normally don&apos;t need to mention the scope after looking up the &quot;root&quot; of your tree of elements.</p>
<p>It can also be used to run multiple versions of the same application inside the same JVM, for example with <a href="https://www.jpro.one/" target="_blank">JPro</a>, which exposes TornadoFX application in a web browser.</p>
<h2 id="a-masterdetail-example">A Master/Detail example</h2>
<p>In an <a href="https://en.wikipedia.org/wiki/Multiple_document_interface" target="_blank">MDI Application</a> you can open an editor in a new window, and ensure that all the injected resources are unique to that window. We will leverage that technique to create a person editor that allows you to open a new window to edit each person.</p>
<p>We start by defining a table interface where you can double click to open the person editor in a separate window.</p>
<pre><code class="lang-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonList</span> : <span class="hljs-type">View</span></span>(<span class="hljs-string">&quot;Person List&quot;</span>) {
    <span class="hljs-variable"><span class="hljs-keyword">val</span> ctrl</span>: PersonController by inject()

    <span class="hljs-keyword">override</span> <span class="hljs-variable"><span class="hljs-keyword">val</span> root</span> = tableview<span class="hljs-type">&lt;Person&gt;</span>() {
        column(<span class="hljs-string">&quot;#&quot;</span>, Person::idProperty)
        column(<span class="hljs-string">&quot;Name&quot;</span>, Person::nameProperty)
        onUserSelect { editPerson(it) }
        asyncItems { ctrl.people() }
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">editPerson</span><span class="hljs-params">(person: <span class="hljs-type">Person</span>)</span> {</span>
        <span class="hljs-variable"><span class="hljs-keyword">val</span> editScope</span> = Scope()
        <span class="hljs-variable"><span class="hljs-keyword">val</span> model</span> = PersonModel()
        model.item = person
        setInScope(model, editScope)
        find(PersonEditor::<span class="hljs-class"><span class="hljs-keyword">class</span>, <span class="hljs-type">editScope).openWindow</span></span>()
    }
}
</code></pre>
<p>The <code>edit</code> function creates a new <code>Scope</code> and injects a <code>PersonModel</code> configured with the selected user into that scope. Finally, it retrieves a <code>PersonEditor</code> in the context of the new scope and opens a new window. <code>find</code> allows for the ability to pass in scopes as a parameter easily between classes, so be sure not to forget this step!  TornadoFX gives more insight on the ability for passing scopes in new instances of components:</p>
<pre><code class="lang-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T: Component&gt;</span> <span class="hljs-title">find</span><span class="hljs-params">(componentType: <span class="hljs-type">Class&lt;T&gt;, scope: Scope</span> = FX.defaultScope)</span>: T = </span>
     <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T: Component&gt;</span> <span class="hljs-title">find</span><span class="hljs-params">(scope: <span class="hljs-type">Scope</span> = FX.defaultScope)</span>: T = </span>
         find(T::<span class="hljs-class"><span class="hljs-keyword">class</span>, <span class="hljs-type">scope)</span></span>
</code></pre>
<p>When the <code>PersonEditor</code> is initialized, it will look up a <code>PersonModel</code> via injection. The default context for <code>inject</code> and <code>find</code> is always the scope that created the component, so it will look in the <code>personScope</code> we just created.</p>
<pre><code class="lang-kotlin"><span class="hljs-variable"><span class="hljs-keyword">val</span> model</span>: PersonModel by inject()
</code></pre>
<h2 id="breaking-out-of-the-current-scope">Breaking Out of the Current Scope</h2>
<p>When no scope is defined, injectable resources are looked up in the default scope. There is an item representing that scope called <code>FX.defaultScope</code>. In the above example, the editor might have called out to a <code>PersonController</code> to perform a save operation in a database or via a REST call. This <code>PersonController</code> is most probably stateless, so there is no need to create a separate controller for each edit window. To access the same controller in all editor windows, we supply the scope we want to find the controller in:</p>
<pre><code class="lang-kotlin"><span class="hljs-variable"><span class="hljs-keyword">val</span> controller</span>: PersonController by inject(FX.defaultScope)
</code></pre>
<p>This effectively makes the <code>PersonController</code> a true singleton object again, with only a single instance in the whole application.</p>
<p>The default scope for new injected objects are always the current scope for the component that calls <code>inject</code> or <code>find</code>, and consequently all objects created in that injection run will belong to the supplied scope.</p>
<h2 id="keeping-state-in-scopes">Keeping State in Scopes</h2>
<p>In the previous example we used injection on a scope level to get a hold of our resources. It is also possible to subclass <code>Scope</code> and put arbitrary data in there. Each TornadoFX <code>Component</code> has a <code>scope</code> property that gives you access to that scope instance. You can even override it to provide the custom subclass so you don&apos;t need to cast it on every occasion:</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">override</span> <span class="hljs-variable"><span class="hljs-keyword">val</span> scope</span> = super.scope <span class="hljs-keyword">as</span> PersonScope
</code></pre>
<p>Now whenever you access the <code>scope</code> property from your code, it will be of type <code>PersonScope</code>. It now contains a <code>PersonModel</code> that will only be available to this scope:</p>
<pre><code class="lang-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonScope</span> : <span class="hljs-type">Scope</span></span>() {
    <span class="hljs-variable"><span class="hljs-keyword">val</span> model</span> = PersonModel()
}
</code></pre>
<p>Let&apos;s change our previous example slightly to access the model inside the scope instead of using injection. First we change the editPerson function:</p>
<pre><code class="lang-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">editPerson</span><span class="hljs-params">(person: <span class="hljs-type">Person</span>)</span> {</span>
    <span class="hljs-variable"><span class="hljs-keyword">val</span> editScope</span> = PersonScope()
    editScope.model.item = person
    find(PersonEditor::<span class="hljs-class"><span class="hljs-keyword">class</span>, <span class="hljs-type">editScope).openWindow</span></span>()
}
</code></pre>
<p>The custom scope already has an instance of <code>PersonModel</code>, so we just configure the item for that scope and open the editor. Now the editor can override the type of scope and access the model:</p>
<pre><code class="lang-kotlin"><span class="hljs-comment">// Cast scope</span>
<span class="hljs-keyword">override</span> <span class="hljs-variable"><span class="hljs-keyword">val</span> scope</span> = super.scope <span class="hljs-keyword">as</span> PersonScope
<span class="hljs-comment">// Extract our view model from the scope</span>
<span class="hljs-variable"><span class="hljs-keyword">val</span> model</span> = scope.model
</code></pre>
<p>Both approaches work equally well, but depending on your use case you might prefer one over the other.</p>
<h2 id="global-application-scope">Global application scope</h2>
<p>As we hintet to initially, you can run multiple applications in the same JVM and keep them completely separate by using scopes. By default, JavaFX does not support multi tenancy, and can only start a single JavaFX application per JVM, but new technologies are emerging that leverages multitenancy and will even expose your JavaFX based applications to the web. One such technology is JPro.one, and TornadoFX supports multitenancy for JPro applications by leveraging scopes.</p>
<p>There is no special JPro classes in TornadoFX, but supporting JPro is very simple by leveranging scopes:</p>
<h2 id="using-tornadofx-with-jpro">Using TornadoFX with JPro</h2>
<p>JPro will create a new instance of your App class for each new web user. Also, to access the JPro WebAPI you need to get access to the stage created for each user. In this example we subclass <code>Scope</code> to create a special JProScope that contains the stage that was given to each application instance:</p>
<pre><code class="lang-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JProScope</span></span>(<span class="hljs-variable"><span class="hljs-keyword">val</span> stage</span>: Stage) : Scope() {
    <span class="hljs-variable"><span class="hljs-keyword">val</span> webAPI</span>: WebAPI <span class="hljs-keyword">get</span>() = WebAPI.getWebAPI(stage)
}
</code></pre>
<p>The next step is to subclass <code>JProApplication</code> to define our entry point. This app class is in addition to our existing TornadoFX App class, which boots the actual application:</p>
<pre><code>class Main : JProApplication() {
    val app = OurTornadoFXApp()

    override fun start(primaryStage: Stage) {
        app.scope = JProScope(primaryStage)
        app.start(primaryStage)
    }

    override fun stop() {
        app.stop()
        super.stop()
    }
}
</code></pre><p>Whenever a new user visits our site, the <code>Main</code> class is created, together with a new instance of our actual TornadoFX application.</p>
<p>In the <code>start</code> function we assign a new <code>JProScope</code> to the TornadoFX app instance and then call <code>app.start</code>. From there on out, all instances created using <code>inject</code> and <code>find</code> will be in the context of that JPro instance.</p>
<p>As usual, you can break out of the <code>JProScope</code> to access JVM level globals by supplying the <code>DefaultScope</code> or any other shared scope to the <code>inject</code> or <code>find</code> functions.</p>
<p>We should provide a utility function that makes it easy to access the JPro WebAPI from any Component:</p>
<pre><code class="lang-kotlin"><span class="hljs-variable"><span class="hljs-keyword">val</span> Component.webAPI</span>: WebAPI <span class="hljs-keyword">get</span>() = (scope <span class="hljs-keyword">as</span> JProScope).webAPI
</code></pre>
<p>The <code>scope</code> property of any <code>Component</code> will be the <code>JProScope</code> so we can cast it and access the <code>webAPI</code> property we defined in our custom scope class.</p>
<h2 id="testing-with-scopes">Testing with Scopes</h2>
<p>Since Scopes allow you to create separate instances of components that are usually singletons, you can leverage Scopes to test Views and even whole App instances.</p>
<p>For example, to generate a new Scope and lookup a View in that scope, you can use the following code:</p>
<pre><code class="lang-kotlin"><span class="hljs-variable"><span class="hljs-keyword">val</span> testScope</span> = Scope()
<span class="hljs-variable"><span class="hljs-keyword">val</span> myView</span> = find<span class="hljs-type">&lt;MyView&gt;</span>(testScope)
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="OSGi.html" class="navigation navigation-prev " aria-label="Previous page: OSGi">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="EventBus.html" class="navigation navigation-next " aria-label="Next page: EventBus">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Scopes","level":"1.3.4","depth":2,"next":{"title":"EventBus","level":"1.3.5","depth":2,"path":"part2/EventBus.md","ref":"part2/EventBus.md","articles":[]},"previous":{"title":"OSGi","level":"1.3.3","depth":2,"path":"part2/OSGi.md","ref":"part2/OSGi.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"part2/Scopes.md","mtime":"2020-02-13T15:46:37.954Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-02-13T15:47:39.413Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

